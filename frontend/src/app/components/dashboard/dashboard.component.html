<div class="dashboard-container">
  <h1>Dashboard</h1>
  
  <div class="periodo-form">
    <form [formGroup]="periodoForm" (ngSubmit)="buscarResumoFinanceiro()">
      <div class="form-row">
        <div class="form-group">
          <label for="dataInicio">Data Início</label>
          <input type="date" id="dataInicio" formControlName="dataInicio">
        </div>
        
        <div class="form-group">
          <label for="dataFim">Data Fim</label>
          <input type="date" id="dataFim" formControlName="dataFim">
        </div>
        
        <button type="submit" class="btn-primary" [disabled]="loading">
          <span *ngIf="loading">Carregando...</span>
          <span *ngIf="!loading">Buscar</span>
        </button>
      </div>
    </form>
  </div>
  
  <div *ngIf="errorMessage" class="alert alert-danger">
    {{ errorMessage }}
  </div>
  
  <div *ngIf="resumoFinanceiro && !loading" class="resumo-cards">
    <div class="card receitas">
      <h3>Receitas</h3>
      <p class="valor">{{ formatCurrency(resumoFinanceiro.totalReceitas) }}</p>
    </div>
    
    <div class="card despesas">
      <h3>Despesas</h3>
      <p class="valor">{{ formatCurrency(resumoFinanceiro.totalDespesas) }}</p>
    </div>
    
    <div class="card saldo" [ngClass]="{'negativo': resumoFinanceiro.saldoTotal < 0}">
      <h3>Saldo</h3>
      <p class="valor">{{ formatCurrency(resumoFinanceiro.saldoTotal) }}</p>
    </div>
  </div>
  
  <div *ngIf="resumoFinanceiro && !loading" class="charts-container">
    <div class="chart-card">
      <h3>Receitas por Categoria</h3>
      <div *ngIf="receitasChartData && receitasChartData.labels.length > 0" class="chart">
        <canvas baseChart 
          [data]="receitasChartData" 
          [type]="'doughnut'" 
          [options]="{responsive: true}">
        </canvas>
      </div>
      <div *ngIf="!receitasChartData || receitasChartData.labels.length === 0" class="no-data">
        Não há dados de receitas para exibir
      </div>
    </div>
    
    <div class="chart-card">
      <h3>Despesas por Categoria</h3>
      <div *ngIf="despesasChartData && despesasChartData.labels.length > 0" class="chart">
        <canvas baseChart 
          [data]="despesasChartData" 
          [type]="'doughnut'" 
          [options]="{responsive: true}">
        </canvas>
      </div>
      <div *ngIf="!despesasChartData || despesasChartData.labels.length === 0" class="no-data">
        Não há dados de despesas para exibir
      </div>
    </div>
    
    <div class="chart-card full-width">
      <h3>Balanço Financeiro</h3>
      <div class="chart">
        <canvas baseChart 
          [data]="balanceChartData" 
          [type]="'bar'" 
          [options]="{responsive: true}">
        </canvas>
      </div>
    </div>
  </div>
  
  <div *ngIf="resumoFinanceiro && resumoFinanceiro.resumoCategorias.length > 0" class="categorias-container">
    <h2>Detalhamento por Categoria</h2>
    
    <div class="categorias-tabs">
      <button class="tab-btn active" onclick="openTab(event, 'receitas')">Receitas</button>
      <button class="tab-btn" onclick="openTab(event, 'despesas')">Despesas</button>
    </div>
    
    <div id="receitas" class="tab-content">
      <table class="categorias-table">
        <thead>
          <tr>
            <th>Categoria</th>
            <th>Valor</th>
            <th>%</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let categoria of resumoFinanceiro.resumoCategorias | filter:'RECEITA':'tipo'">
            <td>{{ categoria.categoriaNome }}</td>
            <td>{{ formatCurrency(categoria.valor) }}</td>
            <td>{{ (categoria.valor / resumoFinanceiro.totalReceitas * 100).toFixed(2) }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <div id="despesas" class="tab-content" style="display: none;">
      <table class="categorias-table">
        <thead>
          <tr>
            <th>Categoria</th>
            <th>Valor</th>
            <th>%</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let categoria of resumoFinanceiro.resumoCategorias | filter:'DESPESA':'tipo'">
            <td>{{ categoria.categoriaNome }}</td>
            <td>{{ formatCurrency(categoria.valor) }}</td>
            <td>{{ (categoria.valor / resumoFinanceiro.totalDespesas * 100).toFixed(2) }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<script>
function openTab(evt, tabName) {
  var i, tabcontent, tablinks;
  
  tabcontent = document.getElementsByClassName("tab-content");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }
  
  tablinks = document.getElementsByClassName("tab-btn");
  for (i = 0; i < tablinks.length; i++) {
    tablinks[i].className = tablinks[i].className.replace(" active", "");
  }
  
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>